import{a as T,aD as I,aC as K,aI as M,a0 as b,r as N,m as v,l as D,a1 as E,ak as l,o as V,Q as $,R as o,X as a,b as R,L as O,U as j,ab as z,W as A}from"./vue.5d8927be.js";import{r as B,v as L,u as G,f as U,h as q,S as J,K as Q,M as W,O as X,G as H,p as Y,E as Z,N as x}from"./index.acfe672b.js";import{a as ee}from"./formatTime.29ac8c52.js";import{M as ae}from"./md5.b5efbca3.js";import{_ as oe}from"./_plugin-vue_export-helper.c27b6911.js";function P(){return B({url:"/api/captcha/",method:"get"})}function se(e){return B({url:"/api/login/",method:"post",data:e})}const te=T({name:"loginAccount",setup(){const{t:e}=L.useI18n(),r=G(),{themeConfig:C}=I(r);I(U());const m=K(),g=M(),t=b({isShowPassword:!1,ruleForm:{username:"",password:"",captcha:"",captchaKey:"",captchaImgBase:""},loading:{signIn:!1}}),h=b({username:[{required:!0,message:"请填写账号",trigger:"blur"}],password:[{required:!0,message:"请填写密码",trigger:"blur"}],captcha:[{required:!0,message:"请填写验证码",trigger:"blur"}]}),c=N(),p=v(()=>ee(new Date)),i=v(()=>q().systemConfig["base.captcha_state"]),_=async()=>{P().then(n=>{t.ruleForm.captchaImgBase=n.data.image_base,t.ruleForm.captchaKey=n.data.key})},f=async()=>{t.ruleForm.captcha="",P().then(n=>{t.ruleForm.captchaImgBase=n.data.image_base,t.ruleForm.captchaKey=n.data.key})},d=async()=>{c.value&&await c.value.validate(n=>{n?se({...t.ruleForm,password:ae.hashStr(t.ruleForm.password)}).then(s=>{s.code===2e3&&(J.set("token",s.data.access),Q.set("username",s.data.name),C.value.isRequestRoutes?(X(),u()):(W(),u()))}).catch(s=>{f()}):H("请填写登录信息")})},y=()=>{U().setUserInfos()},u=()=>{var w,k,S,F;y(),Y().getSystemDictionarys();let n=p.value;(w=m.query)!=null&&w.redirect?g.push({path:(k=m.query)==null?void 0:k.redirect,query:Object.keys((S=m.query)==null?void 0:S.params).length>0?JSON.parse((F=m.query)==null?void 0:F.params):""}):g.push("/"),t.loading.signIn=!0;const s=e("message.signInText");Z.success(`${n}，${s}`),x.start()};return D(()=>{_(),q().getSystemConfigs()}),{refreshCaptcha:f,loginClick:d,loginSuccess:u,isShowCaptcha:i,state:t,formRef:c,rules:h,...E(t)}}});function ne(e,r,C,m,g,t){const h=l("ele-User"),c=l("el-icon"),p=l("el-input"),i=l("el-form-item"),_=l("ele-Unlock"),f=l("ele-Position"),d=l("el-col"),y=l("el-image"),u=l("el-button"),n=l("el-form");return V(),$(n,{ref:"formRef",size:"large",class:"login-content-form",model:e.state.ruleForm,rules:e.rules},{default:o(()=>[a(i,{class:"login-animation1",prop:"username"},{default:o(()=>[a(p,{type:"text",placeholder:e.$t("message.account.accountPlaceholder1"),modelValue:e.ruleForm.username,"onUpdate:modelValue":r[0]||(r[0]=s=>e.ruleForm.username=s),clearable:"",autocomplete:"off"},{prefix:o(()=>[a(c,{class:"el-input__icon"},{default:o(()=>[a(h)]),_:1})]),_:1},8,["placeholder","modelValue"])]),_:1}),a(i,{class:"login-animation2",prop:"password"},{default:o(()=>[a(p,{type:e.isShowPassword?"text":"password",placeholder:e.$t("message.account.accountPlaceholder2"),modelValue:e.ruleForm.password,"onUpdate:modelValue":r[2]||(r[2]=s=>e.ruleForm.password=s)},{prefix:o(()=>[a(c,{class:"el-input__icon"},{default:o(()=>[a(_)]),_:1})]),suffix:o(()=>[R("i",{class:O(["iconfont el-input__icon login-content-password",e.isShowPassword?"icon-yincangmima":"icon-xianshimima"]),onClick:r[1]||(r[1]=s=>e.isShowPassword=!e.isShowPassword)},null,2)]),_:1},8,["type","placeholder","modelValue"])]),_:1}),e.isShowCaptcha?(V(),$(i,{key:0,class:"login-animation3",prop:"captcha"},{default:o(()=>[a(d,{span:15},{default:o(()=>[a(p,{type:"text",maxlength:"4",placeholder:e.$t("message.account.accountPlaceholder3"),modelValue:e.ruleForm.captcha,"onUpdate:modelValue":r[3]||(r[3]=s=>e.ruleForm.captcha=s),clearable:"",autocomplete:"off"},{prefix:o(()=>[a(c,{class:"el-input__icon"},{default:o(()=>[a(f)]),_:1})]),_:1},8,["placeholder","modelValue"])]),_:1}),a(d,{span:1}),a(d,{span:8},{default:o(()=>[a(u,{class:"login-content-captcha"},{default:o(()=>[a(y,{src:e.ruleForm.captchaImgBase,onClick:e.refreshCaptcha},null,8,["src","onClick"])]),_:1})]),_:1})]),_:1})):j("",!0),a(i,{class:"login-animation4"},{default:o(()=>[a(u,{type:"primary",class:"login-content-submit",round:"",onKeyup:z(e.loginClick,["enter"]),onClick:e.loginClick,loading:e.loading.signIn},{default:o(()=>[R("span",null,A(e.$t("message.account.accountBtnText")),1)]),_:1},8,["onKeyup","onClick","loading"])]),_:1})]),_:1},8,["model","rules"])}const me=oe(te,[["render",ne],["__scopeId","data-v-c6614419"]]);export{me as default};
