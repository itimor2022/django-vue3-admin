import{l as U,U as L,A as q}from"./api.dbeb9b81.js";import{I as B,x as N}from"./index.acfe672b.js";import{a as R,r as c,a0 as V,l as T,ak as m,o as j,Q as z,R as i,X as o,u as t,V as b,W as A}from"./vue.5d8927be.js";import{_ as I}from"./_plugin-vue_export-helper.c27b6911.js";const M=R({__name:"index",props:{initFormData:{default:()=>null},treeData:{default:()=>[]},cacheData:{default:()=>[]}},emits:["drawerClose"],setup(g,{emit:k}){const w={children:"children",label:"name",value:"id",isLeaf:(l,e)=>!(e!=null&&e.data.hasChild)},p=c(),v=V({name:[{required:!0,message:"部门名称必填",trigger:"blur"}],key:[{required:!0,message:"部门标识必填",trigger:"blur"}]}),n=g,F=k;let _=c([]),a=V({key:"",parent:"",name:"",owner:"",description:""}),f=c(!1);const h=()=>{var l,e;(l=n.initFormData)!=null&&l.id&&(a.id=(e=n.initFormData)==null?void 0:e.id,a.key=n.initFormData.key||"",a.parent=n.initFormData.parent||"",a.name=n.initFormData.name||"",a.owner=n.initFormData.owner||"",a.description=n.initFormData.description||"")},x=(l,e)=>{l.level!==0&&U({parent:l.data.id}).then(r=>{e(r.data)})},C=()=>{var l;(l=p.value)==null||l.validate(async e=>{if(e)try{let r;f.value=!0,a.id?r=await L(a):r=await q(a),(r==null?void 0:r.code)===2e3&&(N(r.msg),y("submit"))}finally{f.value=!1}})},y=(l="")=>{var e;F("drawerClose",l),(e=p.value)==null||e.resetFields()};return T(async()=>{n.treeData.map(l=>{_.value.push(l)}),h()}),(l,e)=>{const r=m("el-tree-select"),s=m("el-form-item"),u=m("el-input"),D=m("el-button");return j(),z(t(B),{ref_key:"formRef",ref:p,rules:v,model:t(a),"label-width":"100px","label-position":"right",class:"dept-form-com"},{default:i(()=>[o(s,{label:"父级部门",prop:"parent"},{default:i(()=>[o(r,{modelValue:t(a).parent,"onUpdate:modelValue":e[0]||(e[0]=d=>t(a).parent=d),props:w,data:t(_),"cache-data":n.cacheData,lazy:"","check-strictly":"",load:x,style:{width:"100%"}},null,8,["modelValue","data","cache-data"])]),_:1}),o(s,{required:"",label:"部门名称",prop:"name"},{default:i(()=>[o(u,{modelValue:t(a).name,"onUpdate:modelValue":e[1]||(e[1]=d=>t(a).name=d)},null,8,["modelValue"])]),_:1}),o(s,{required:"",label:"部门标识",prop:"key"},{default:i(()=>[o(u,{modelValue:t(a).key,"onUpdate:modelValue":e[2]||(e[2]=d=>t(a).key=d)},null,8,["modelValue"])]),_:1}),o(s,{label:"负责人"},{default:i(()=>[o(u,{modelValue:t(a).owner,"onUpdate:modelValue":e[3]||(e[3]=d=>t(a).owner=d),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),o(s,{label:"备注"},{default:i(()=>[o(u,{modelValue:t(a).description,"onUpdate:modelValue":e[4]||(e[4]=d=>t(a).description=d),maxlength:"200","show-word-limit":"",type:"textarea"},null,8,["modelValue"])]),_:1}),o(s,null,{default:i(()=>[o(D,{onClick:C,type:"primary",loading:t(f)},{default:i(()=>[b(A(t(a).id?"保存":"新增"),1)]),_:1},8,["loading"]),o(D,{onClick:y},{default:i(()=>[b("取消 ")]),_:1})]),_:1})]),_:1},8,["rules","model"])}}});const S=I(M,[["__scopeId","data-v-aa6a357a"]]);export{S as default};
