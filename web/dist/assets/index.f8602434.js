import E from"./index.68a6dc43.js";import{g as H,b as P,d as R}from"./api.d42bee3a.js";import{x as w,y as I,t as $}from"./index.acfe672b.js";import{a as q,a0 as x,r as k,ak as f,as as A,o as v,c as G,b,X as s,R as u,V as g,S as M,u as l,Q as D,U as O,H as Q,aG as X,aH as J}from"./vue.5d8927be.js";import{_ as K}from"./_plugin-vue_export-helper.c27b6911.js";const L=m=>(X("data-v-1a4f1998"),m=m(),J(),m),W={class:"columns-table-com"},Y=L(()=>b("p",{class:"ctc-title"},"字段权限",-1)),Z={class:"ctc-head"},ee={class:"ctc-pagination"},te=q({__name:"index",props:{currentInfo:{type:Object,required:!0,default:()=>{}}},setup(m,{expose:V}){const r=m;let c=x({page:1,limit:20}),i=x({loading:!1,data:[],total:0}),d=k(!1),C=k({});const p=async(t=r.currentInfo)=>{try{i.loading=!0;const e=await H({...c,...t});(e==null?void 0:e.code)===2e3&&(i.data=e.data,i.total=e.total)}finally{i.loading=!1}},z=async()=>{var t,e,a;if((t=r.currentInfo)!=null&&t.role&&((e=r.currentInfo)!=null&&e.model)&&((a=r.currentInfo)!=null&&a.app)){const o=await P(r.currentInfo);(o==null?void 0:o.code)===2e3&&(w("匹配成功"),p());return}I("请选择角色和模型表！")},h=(t,e)=>{var a,o,_;if((a=r.currentInfo)!=null&&a.role&&((o=r.currentInfo)!=null&&o.model)&&((_=r.currentInfo)!=null&&_.app)){t==="update"&&e&&(C.value=e),d.value=!0;return}I("请选择角色和模型表！")},y=t=>{t==="submit"&&p(),d.value=!1,C.value={}},B=({id:t})=>{$.confirm("确定删除该字段吗？","提示",{type:"error",confirmButtonText:"确定",cancelButtonText:"取消"}).then(async()=>{const e=await R(t);(e==null?void 0:e.code)===2e3&&(w("删除成功"),p())}).catch(()=>{})},S=t=>{c.limit=t,p()},N=t=>{c.page=t,p()};return V({fetchData:p}),(t,e)=>{const a=f("el-button"),o=f("el-table-column"),_=f("el-table"),U=f("el-pagination"),F=f("el-drawer"),T=A("loading");return v(),G("div",W,[Y,b("div",Z,[s(a,{type:"primary",onClick:e[0]||(e[0]=n=>h("create"))},{default:u(()=>[g("新增")]),_:1}),s(a,{type:"primary",onClick:z},{default:u(()=>[g("自动匹配")]),_:1})]),M((v(),D(_,{data:l(i).data,border:"",class:"ctc-table"},{default:u(()=>[s(o,{prop:"field_name",label:"字段名"}),s(o,{prop:"title",label:"列名"}),s(o,{label:"操作",width:"180",align:"center"},{default:u(n=>[s(a,{type:"primary",onClick:j=>h("update",n.row)},{default:u(()=>[g("编辑")]),_:2},1032,["onClick"]),s(a,{type:"danger",onClick:j=>B(n.row)},{default:u(()=>[g("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[T,l(i).loading]]),b("div",ee,[s(U,{"current-page":l(c).page,"onUpdate:currentPage":e[1]||(e[1]=n=>l(c).page=n),"page-size":l(c).limit,"onUpdate:pageSize":e[2]||(e[2]=n=>l(c).limit=n),"page-sizes":[5,10,20,50],total:l(i).total,background:"",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:S,onCurrentChange:N},null,8,["current-page","page-size","total"])]),s(F,{modelValue:l(d),"onUpdate:modelValue":e[3]||(e[3]=n=>Q(d)?d.value=n:d=n),title:"字段权限",direction:"rtl",size:"500px","close-on-click-modal":!1,"before-close":y},{default:u(()=>[l(d)?(v(),D(E,{key:0,currentInfo:r.currentInfo,initFormData:l(C),onDrawerClose:y},null,8,["currentInfo","initFormData"])):O("",!0)]),_:1},8,["modelValue"])])}}});const se=K(te,[["__scopeId","data-v-1a4f1998"]]);export{se as default};
