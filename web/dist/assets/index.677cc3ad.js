import{a as E,r as i,a0 as j,l as q,ak as f,as as J,o as N,c as K,S as F,Y as $,u as a,b as o,W as y,X as c,H as V,R as p,Q as ee,V as D,O as te,F as oe,aG as se,aH as ae}from"./vue.5d8927be.js";import{w as ne,D as le,y as P,x as de}from"./index.acfe672b.js";import{M as H}from"./md5.b5efbca3.js";import{c as ie,g as re,r as ce}from"./crud.f93f339f.js";import{_ as pe}from"./index.vue_vue_type_script_setup_true_name_importExcel_lang.665418ad.js";import{i as W,L as ue}from"./echarts.30c674e7.js";import{_ as me}from"./_plugin-vue_export-helper.c27b6911.js";import"./dictionary.d76d7a20.js";import"./authFunction.88002d4f.js";const b=h=>(se("data-v-cb1ce045"),h=h(),ae(),h),_e={class:"dept-user-com-box dept-info"},we={class:"di-left"},fe={class:"di-cell"},he=b(()=>o("p",null,"部门负责人：",-1)),ve={class:"content"},ge={class:"di-cell"},xe=b(()=>o("p",null,"部门人数：",-1)),ye={class:"content"},Pe={class:"di-cell"},be=b(()=>o("p",null,"部门简介：",-1)),Ce={class:"content"},Se={class:"di-cell"},Ve=b(()=>o("p",null,"显示子级：",-1)),De={class:"dialog-footer"},ke=E({name:"user"}),Re=E({...ke,setup(h,{expose:L}){let k,R;const B=i(),I=i(),{crudExpose:v}=ne({crudRef:B,crudBinding:I});let g=i(""),O=i(),U=i(),u=i(!1),n=i({}),r=i(!1),m=i(!1),t=j({id:0,newPassword:"",newPassword2:""});const M=()=>{var d,x;const s=((d=n.value.sub_dept_map)==null?void 0:d.map(w=>w.name))||[],e=((x=n.value.sub_dept_map)==null?void 0:x.map(w=>w.count))||[],_={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:s,axisTick:{alignWithLabel:!0}},yAxis:{type:"value"},dataZoom:[{type:"inside"}],grid:{top:"6%",right:"5%",bottom:"10%",left:"10%"},series:[{data:e,type:"bar",barWidth:"60%",showBackground:!0,itemStyle:{color:new ue(0,0,0,1,[{offset:0,color:"#83bff6"},{offset:.5,color:"#188df0"},{offset:1,color:"#188df0"}])}}]};k.setOption(_)},G=()=>{var e,_,d;const s={tooltip:{trigger:"item"},legend:{orient:"vertical",right:"0%",left:"65%",top:"center",itemWidth:12,itemHeight:12},series:[{type:"pie",radius:"65%",center:["32%","50%"],label:{show:!1,position:"center"},color:["#188df0","#f56c6c","#dcdfe6"],data:[{value:((e=n.value.gender)==null?void 0:e.male)||0,name:"男"},{value:((_=n.value.gender)==null?void 0:_.female)||0,name:"女"},{value:((d=n.value.gender)==null?void 0:d.unknown)||0,name:"未知"}]}]};R.setOption(s)},C=async()=>{const s=await re(g.value,u.value?"1":"0");(s==null?void 0:s.code)===2e3&&(n.value=s.data,M(),G())},A=s=>{g.value=s,v.doSearch({form:{dept:s}}),C()},T=()=>{A(g.value)},Z=({id:s})=>{t.id=s,m.value=!0},S=()=>{m.value=!1,t.id=0,t.newPassword="",t.newPassword2=""},z=async()=>{if(!t.id){P("请选择用户！");return}if(!t.newPassword||!t.newPassword2){P("请输入密码！");return}if(t.newPassword!==t.newPassword2){P("两次输入密码不一致");return}const s=new RegExp("(?=.*[0-9])(?=.*[a-zA-Z]).{8,30}");if(!s.test(t.newPassword)||!s.test(t.newPassword2)){P("您的密码复杂度太低(密码中必须包含字母、数字)");return}const e=await ce(t.id,{newPassword:H.hashStr(t.newPassword),newPassword2:H.hashStr(t.newPassword2)});(e==null?void 0:e.code)===2e3&&(de(e.msg||"修改成功！"),S())};q(()=>{k=W(O.value),R=W(U.value),C(),v.doRefresh()}),L({handleDoRefreshUser:A});const{crudOptions:Q}=ie({crudExpose:v,context:{getDeptInfo:C,isShowChildFlag:u,handleResetPwdOpen:Z}});return le({crudExpose:v,crudOptions:Q,context:{}}),(s,e)=>{const _=f("el-switch"),d=f("el-button"),x=f("fs-crud"),w=f("el-input"),X=f("el-dialog"),Y=J("auth");return N(),K(oe,null,[F(o("div",_e,[o("div",we,[o("h3",null,y(a(n).dept_name||""),1),o("div",fe,[he,o("p",ve,y(a(n).owner||"无"),1)]),o("div",ge,[xe,o("p",ye,y(a(n).dept_user||0)+"人",1)]),o("div",Pe,[be,o("p",Ce,y(a(n).description||"无"),1)]),o("div",Se,[Ve,c(_,{modelValue:a(u),"onUpdate:modelValue":e[0]||(e[0]=l=>V(u)?u.value=l:u=l),"inline-prompt":"","active-text":"是","inactive-text":"否",disabled:!a(g),onChange:T,style:{"--el-switch-on-color":"var(--el-color-primary)"}},null,8,["modelValue","disabled"])])]),o("div",{style:{height:"180px",width:"380px"},ref_key:"deptCountBar",ref:O},null,512),o("div",{style:{height:"180px",width:"200px"},ref_key:"deptSexPie",ref:U},null,512)],512),[[$,!a(r)]]),c(x,te({ref_key:"crudRef",ref:B},I.value,{customClass:a(r)?"dept-user-com-box dept-user-com-table-cover":"dept-user-com-box dept-user-com-table"}),{"toolbar-left":p(()=>[c(d,{icon:a(r)?"View":"Hide",circle:"",onClick:e[1]||(e[1]=l=>V(r)?r.value=!a(r):r=!a(r))},null,8,["icon"])]),"actionbar-right":p(()=>[F((N(),ee(pe,{api:"api/system/user/"},{default:p(()=>[D("导入 ")]),_:1})),[[Y,"user:Import"]])]),_:1},16,["customClass"]),c(X,{modelValue:a(m),"onUpdate:modelValue":e[4]||(e[4]=l=>V(m)?m.value=l:m=l),title:"重设密码",width:"400px",draggable:"","before-close":S},{footer:p(()=>[o("span",De,[c(d,{onClick:S},{default:p(()=>[D("取消")]),_:1}),c(d,{type:"primary",onClick:z},{default:p(()=>[D(" 保存 ")]),_:1})])]),default:p(()=>[o("div",null,[c(w,{modelValue:a(t).newPassword,"onUpdate:modelValue":e[2]||(e[2]=l=>a(t).newPassword=l),type:"password",placeholder:"请输入密码","show-password":"",style:{"margin-bottom":"20px"}},null,8,["modelValue"]),c(w,{modelValue:a(t).newPassword2,"onUpdate:modelValue":e[3]||(e[3]=l=>a(t).newPassword2=l),type:"password",placeholder:"请再次输入密码","show-password":""},null,8,["modelValue"])])]),_:1},8,["modelValue"])],64)}}});const Ee=me(Re,[["__scopeId","data-v-cb1ce045"]]);export{Ee as default};
