import{s as ge,D as le,U as Ve,G as Ue}from"./api.7d6ff680.js";import{d as q}from"./dictionary.d76d7a20.js";import{d as oe,S as xe,z as we,C as Ce,F as Oe,G as I,s as Se}from"./index.acfe672b.js";import{a as Ie,a0 as te,r as b,G as Re,w as ze,ak as u,o as d,c as k,X as t,R as o,V as y,F as L,aa as W,Q as f,W as O,b as v,u as n,H as ae,U as Te,aG as je,aH as Ne,n as Le}from"./vue.5d8927be.js";import{_ as We}from"./_plugin-vue_export-helper.c27b6911.js";const R=x=>(je("data-v-6a6a399a"),x=x(),Ne(),x),De={key:1},$e={slot:"prepend"},Be={style:{padding:"0px 5px"}},Ge={key:1},qe=R(()=>v("i",{class:"el-icon-plus"},null,-1)),Ee=R(()=>v("div",{slot:"tip",class:"el-upload__tip"},"请选取图片,并且只能上传jpg/png文件",-1)),Fe=["src"],Je=R(()=>v("i",{class:"el-icon-plus"},null,-1)),He=R(()=>v("div",{slot:"tip",class:"el-upload__tip"},"请选取图片,并且只能上传jpg/png文件",-1)),Ae=["src"],Me=R(()=>v("p",null,"删除后无法恢复,确定删除吗？",-1)),Pe={style:{"text-align":"right",margin:"0"}},Qe=Ie({__name:"formContent",props:["options","editableTabsItem"],setup(x){const E=x;let s=te({}),h=b([]);b([]);let w=b(!1);const ne=te({title:[{required:!0,message:"必须填写"}],key:[{required:!0,message:"必须填写"}],value:[{required:!0,message:"必须填写"}]}),F=b();let J=b(oe()+"api/system/file/"),H=b({Authorization:"JWT "+xe.get("token")}),D=b(""),$=b(!1);b(null);const se=()=>{Ue({parent:E.options.id,limit:999}).then(a=>{let r=a.data;h.value=r;const p={};for(const c of r){const i=c.key;c.value?p[i]=c.value:[5,12,14].indexOf(c.form_item_type)!==-1?p[i]=[]:p[i]=c.value,c.form_item_type_label==="array"&&(console.log("test"),Le(()=>{const g=b();console.log(g)}))}s=Object.assign(s,p)})},de=a=>{const r=Object.keys(s),p=Object.values(s);for(const c in h.value){const i=h.value[c];i.form_item_type_label==="array"&&(i.id,""+i.key),r.map((S,C)=>{if(S===i.key&&(i.form_item_type_label!=="array"&&(i.value=p[C]),["img","imgs"].indexOf(i.form_item_type_label)>-1)){for(const T of i.rule)if(T.required&&i.value===null){I(i.title+"不能为空");return}}})}a&&a.validate(c=>{if(c)ge(h.value).then(i=>{Se("保存成功"),z&&z()});else return console.log("error submit!!"),!1})},re=a=>{},ie=(a,r,p)=>{console.log(a,r),a.id&&le(a.id).then(c=>{})},A=a=>{D=a.url,$.value=!0},ue=a=>{if(typeof a!="string")return;const r=a.toLowerCase();return r.endsWith(".png")||r.endsWith(".jpeg")||r.endsWith(".jpg")||r.endsWith(".png")||r.endsWith(".bmp")},M=(a,r,p,c)=>{const{code:i,msg:g}=a;if(i===2e3){const{url:S}=a.data,{name:C}=r;if(!ue(C))I("只允许上传图片");else{const j=s[c];(!j||j==="")&&(s[c]=[]);const B={name:C,url:oe()+S};s[c].push(B)}}else I("上传失败,"+JSON.stringify(g))},P=()=>{I("上传失败")},Q=()=>{I("超过文件上传数量")},X=(a,r,p)=>{var c=0;s[p].map((i,g)=>{i.uid===a.uid&&(c=g)}),s[p].splice(c,1)},pe=a=>{le(a.id).then(r=>{})},ce=a=>{h.value[a].edit=!0,h.value[a].new_key=h.value[a].key},z=Re("refreshView"),_e=a=>{a.key=JSON.parse(JSON.stringify(a.new_key)),Ve(a).then(r=>{z&&z()})};return ze(E.options,a=>{a&&a.id&&se()},{immediate:!0}),(a,r)=>{const p=u("el-col"),c=u("el-row"),i=u("el-input"),g=u("el-input-number"),S=u("el-date-picker"),C=u("el-option"),T=u("el-select"),j=u("el-checkbox"),B=u("el-checkbox-group"),fe=u("el-radio"),me=u("el-radio-group"),Y=u("el-switch"),Z=u("el-upload"),K=u("el-dialog"),ye=u("table-selector"),G=u("vxe-input"),N=u("vxe-column"),V=u("el-button"),ke=u("el-popover"),ve=u("vxe-table"),be=u("el-popconfirm"),ee=u("el-form-item"),he=u("el-form");return d(),k("div",null,[t(c,{gutter:20},{default:o(()=>[t(p,{span:4},{default:o(()=>[y("变量标题")]),_:1}),t(p,{span:4},{default:o(()=>[y("变量名")]),_:1}),t(p,{span:10},{default:o(()=>[y("变量值")]),_:1}),t(p,{span:2,offset:1},{default:o(()=>[y("是否前端配置")]),_:1}),t(p,{span:3},{default:o(()=>[y("操作")]),_:1})]),_:1}),t(he,{ref_key:"formRef",ref:F,model:n(s),"label-width":"0px","label-position":"left",style:{"margin-top":"20px"}},{default:o(()=>[(d(!0),k(L,null,W(n(h),(e,m)=>(d(),f(ee,{prop:["array"].indexOf(e.form_item_type_label)>-1?"":e.key,key:m,rules:e.rule||[]},{default:o(()=>[t(p,{span:4},{default:o(()=>[e.edit?(d(),f(i,{key:0,modelValue:e.title,"onUpdate:modelValue":l=>e.title=l,style:{display:"inline-block",width:"200px"},placeholder:"请输入标题"},null,8,["modelValue","onUpdate:modelValue"])):(d(),k("span",De,O(e.title),1))]),_:2},1024),t(p,{span:4},{default:o(()=>[e.edit?(d(),f(i,{key:0,modelValue:e.new_key,"onUpdate:modelValue":l=>e.new_key=l,style:{width:"200px"},placeholder:"请输入变量key"},{default:o(()=>[v("template",$e,[v("span",Be,O(x.editableTabsItem.key),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"])):(d(),k("span",Ge,O(x.editableTabsItem.key)+"."+O(e.key),1))]),_:2},1024),t(p,{span:10},{default:o(()=>[["text","textarea"].indexOf(e.form_item_type_label)>-1?(d(),f(i,{key:m,type:e.form_item_type_label,modelValue:n(s)[e.key],"onUpdate:modelValue":l=>n(s)[e.key]=l,placeholder:e.placeholder,clearable:""},null,8,["type","modelValue","onUpdate:modelValue","placeholder"])):e.form_item_type_label==="number"?(d(),f(g,{key:m+1,modelValue:n(s)[e.key],"onUpdate:modelValue":l=>n(s)[e.key]=l,min:0},null,8,["modelValue","onUpdate:modelValue"])):["datetime","date","time"].indexOf(e.form_item_type_label)>-1?(d(),f(S,{modelValue:n(s)[e.key],"onUpdate:modelValue":l=>n(s)[e.key]=l,key:m+2,type:e.form_item_type_label,placeholder:e.placeholder},null,8,["modelValue","onUpdate:modelValue","type","placeholder"])):e.form_item_type_label==="select"?(d(),f(T,{key:m+3,modelValue:n(s)[e.key],"onUpdate:modelValue":l=>n(s)[e.key]=l,placeholder:e.placeholder,clearable:""},{default:o(()=>[(d(!0),k(L,null,W(n(q)(e.setting)||[],l=>(d(),f(C,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):e.form_item_type_label==="checkbox"?(d(),f(B,{key:m+4,modelValue:n(s)[e.key],"onUpdate:modelValue":l=>n(s)[e.key]=l,placeholder:e.placeholder},{default:o(()=>[(d(!0),k(L,null,W(n(q)(e.setting)||[],l=>(d(),f(j,{key:l.value,label:l.value,value:l.value},{default:o(()=>[y(O(l.label),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):e.form_item_type_label==="radio"?(d(),f(me,{key:m+5,modelValue:n(s)[e.key],"onUpdate:modelValue":l=>n(s)[e.key]=l,placeholder:e.placeholder,clearable:""},{default:o(()=>[(d(!0),k(L,null,W(n(q)(e.setting)||[],l=>(d(),f(fe,{key:l.value,label:l.value,value:l.value},{default:o(()=>[y(O(l.label),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):e.form_item_type_label==="switch"?(d(),f(Y,{key:m+6,modelValue:n(s)[e.key],"onUpdate:modelValue":l=>n(s)[e.key]=l,"inactive-value":!1,"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue","onUpdate:modelValue"])):["img","imgs"].indexOf(e.form_item_type_label)>-1?(d(),k("div",{key:m+7},[t(Z,{action:n(J),headers:n(H),name:"file",accept:"image/*","on-preview":A,"on-success":(l,_,U)=>{M(l,_,U,e.key)},"on-error":P,"on-exceed":Q,"before-remove":(l,_)=>{X(l,_,e.key)},multiple:e.form_item_type_label!=="img",limit:e.form_item_type_label==="img"?1:5,ref_for:!0,ref:"imgUpload_"+e.key,"data-keyname":e.key,"file-list":e.value?e.value:[],"list-type":"picture-card"},{default:o(()=>[qe,Ee]),_:2},1032,["action","headers","on-success","before-remove","multiple","limit","data-keyname","file-list"]),t(K,{visible:n($)},{default:o(()=>[v("img",{width:"100%",src:n(D),alt:""},null,8,Fe)]),_:1},8,["visible"])])):["file"].indexOf(e.form_item_type_label)>-1?(d(),k("div",{key:m+8},[t(Z,{action:n(J),headers:n(H),name:"file","on-preview":A,"on-success":(l,_,U)=>{M(l,_,U,e.key)},"on-error":P,"on-exceed":Q,"before-remove":(l,_)=>{X(l,_,e.key)},limit:5,ref_for:!0,ref:"fileUpload_"+e.key,"data-keyname":e.key,"file-list":e.value,"list-type":"picture-card"},{default:o(()=>[Je,He]),_:2},1032,["action","headers","on-success","before-remove","data-keyname","file-list"]),t(K,{visible:n($)},{default:o(()=>[v("img",{width:"100%",src:n(D),alt:""},null,8,Ae)]),_:1},8,["visible"])])):["foreignkey","manytomany"].indexOf(e.form_item_type_label)>-1?(d(),k("div",{key:m+9},[t(ye,{modelValue:n(s)[e.key],"onUpdate:modelValue":l=>n(s)[e.key]=l,"el-props":{pagination:!0,columns:e.setting.searchField},dict:{url:"/api/system/system_config/get_table_data/"+e.id+"/",value:e.setting.primarykey,label:e.setting.field},pagination:!0,multiple:e.form_item_type_label==="manytomany"},null,8,["modelValue","onUpdate:modelValue","el-props","dict","multiple"])])):e.form_item_type_label==="array"?(d(),k("div",{key:m+10},[t(ve,{border:"",resizable:"","auto-resize":"","show-overflow":"","keep-source":"",ref_for:!0,ref:"xTable_"+e.key,height:"200","edit-rules":ne,"edit-config":{trigger:"click",mode:"row",showStatus:!0}},{default:o(()=>[t(N,{field:"title",title:"标题","edit-render":{autofocus:".vxe-input--inner"}},{edit:o(({row:l})=>[t(G,{modelValue:l.title,"onUpdate:modelValue":_=>l.title=_,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(N,{field:"key",title:"键名","edit-render":{autofocus:".vxe-input--inner"}},{edit:o(({row:l})=>[t(G,{modelValue:l.key,"onUpdate:modelValue":_=>l.key=_,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(N,{field:"value",title:"键值","edit-render":{}},{edit:o(({row:l})=>[t(G,{modelValue:l.value,"onUpdate:modelValue":_=>l.value=_,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(N,{title:"操作",width:"100","show-overflow":""},{default:o(({row:l,index:_})=>[t(ke,{placement:"top",width:"160",modelValue:n(w),"onUpdate:modelValue":r[1]||(r[1]=U=>ae(w)?w.value=U:w=U)},{default:o(()=>[Me,v("div",Pe,[t(V,{size:"mini",type:"text",onClick:r[0]||(r[0]=U=>ae(w)?w.value=!1:w=!1)},{default:o(()=>[y("取消")]),_:1}),t(V,{type:"primary",size:"mini",onClick:U=>ie(l,_,e.key)},{default:o(()=>[y("确定")]),_:2},1032,["onClick"])]),t(V,{type:"text",slot:"reference"},{default:o(()=>[y("删除")]),_:1})]),_:2},1032,["modelValue"])]),_:2},1024)]),_:2},1032,["edit-rules"]),v("div",null,[t(V,{size:"mini",onClick:l=>re("xTable_"+e.key)},{default:o(()=>[y("追加")]),_:2},1032,["onClick"])])])):Te("",!0)]),_:2},1024),t(p,{span:2,offset:1},{default:o(()=>[t(Y,{modelValue:e.status,"onUpdate:modelValue":l=>e.status=l,"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(p,{span:3},{default:o(()=>[e.edit?(d(),f(V,{key:0,size:"mini",type:"primary",icon:n(we),onClick:l=>_e(e)},{default:o(()=>[y("保存")]),_:2},1032,["icon","onClick"])):(d(),f(V,{key:1,size:"mini",type:"primary",icon:n(Ce),onClick:l=>ce(m)},null,8,["icon","onClick"])),t(be,{title:"确定删除该条数据吗？",onConfirm:l=>pe(e)},{reference:o(()=>[t(V,{size:"mini",type:"danger",icon:n(Oe)},null,8,["icon"])]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1032,["prop","rules"]))),128)),t(ee,null,{default:o(()=>[t(V,{type:"primary",onClick:r[2]||(r[2]=e=>de(F.value))},{default:o(()=>[y("确定")]),_:1})]),_:1})]),_:1},8,["model"])])}}});const ll=We(Qe,[["__scopeId","data-v-6a6a399a"]]);export{ll as default};
