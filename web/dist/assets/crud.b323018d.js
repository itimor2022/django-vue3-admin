import{r as _,X as Q,A as O,Q as E}from"./index.acfe672b.js";import{a as N,r as y,w as T,a0 as H,ak as b,o as f,Q as M,R,b as K,X as V,U as $,c as U,F as z,aa as B,V as J,W as Y,m as D,s as h}from"./vue.5d8927be.js";import{_ as I}from"./_plugin-vue_export-helper.c27b6911.js";import{a as q}from"./authFunction.88002d4f.js";const v="/api/system/message_center/";function Z(a){return _({url:v,method:"get",params:a})}function ee(a){return _({url:v+a+"/",method:"get"})}function te(a){return _({url:v+"get_self_receive/",method:"get",params:a})}function ae(a){return _({url:v,method:"post",data:a})}function le(a){return _({url:v+a.id+"/",method:"put",data:a})}function ne(a){return _({url:v+a+"/",method:"delete",data:{id:a}})}const oe={class:"option"},re=N({__name:"index",props:{modelValue:{},tableConfig:{url:null,label:null,value:null,isTree:!1,data:[],isMultiple:!1,columns:[]},displayLabel:{}},emits:["update:modelValue"],setup(a,{emit:d}){const o=a,g=d,w=y(),r=y(),m=y();T(m,t=>{const{tableConfig:n}=o;if(!n.isMultiple)r.value=t?t[n.label]:null;else{const i=t?t.map(c=>c[n.label]):null;r.value=i}},{immediate:!0});const p=y(void 0),e=y(),l=H({page:1,limit:10,total:0}),j=t=>{m.value=t;const{tableConfig:n}=o,i=t.map(c=>c[n.value]);g("update:modelValue",i)},A=t=>{m.value=t;const{tableConfig:n}=o;g("update:modelValue",t[n.value])},x=async()=>{const t=o.tableConfig.url,n={page:l.page,limit:l.limit,search:p.value},{data:i,page:c,limit:C,total:k}=await _({url:t,params:n});l.page=c,l.limit=C,l.total=k,o.tableConfig.data===void 0||o.tableConfig.data.length===0?o.tableConfig.isTree?e.value=Q.toArrayTree(i,{parentKey:"parent",key:"id",children:"children"}):e.value=i:e.value=o.tableConfig.data},F=t=>{t&&x()},G=t=>{l.page=t,x()};return T(()=>o.displayLabel,t=>{const{tableConfig:n}=o,i=t?t.map(c=>c[n.label]):null;r.value=i},{immediate:!0}),(t,n)=>{const i=b("el-button"),c=b("el-input"),C=b("el-table-column"),k=b("el-table"),P=b("el-pagination"),W=b("el-select");return f(),M(W,{"popper-class":"popperClass",class:"tableSelector",multiple:o.tableConfig.isMultiple,onRemoveTag:t.removeTag,modelValue:r.value,"onUpdate:modelValue":n[3]||(n[3]=s=>r.value=s),placeholder:"请选择",onVisibleChange:F},{empty:R(()=>[K("div",oe,[V(c,{style:{"margin-bottom":"10px"},modelValue:p.value,"onUpdate:modelValue":n[0]||(n[0]=s=>p.value=s),clearable:"",placeholder:"请输入关键词",onChange:x,onClear:x},{append:R(()=>[V(i,{type:"primary",icon:"Search"})]),_:1},8,["modelValue"]),V(k,{ref_key:"tableRef",ref:w,data:e.value,size:"mini",border:"","row-key":"id",style:{width:"400px"},"max-height":"200",height:"200","highlight-current-row":!o.tableConfig.isMultiple,onSelectionChange:j,onCurrentChange:A},{default:R(()=>[o.tableConfig.isMultiple?(f(),M(C,{key:0,fixed:"",type:"selection",width:"55"})):$("",!0),V(C,{fixed:"",type:"index",label:"#",width:"50"}),(f(!0),U(z,null,B(o.tableConfig.columns,(s,X)=>(f(),M(C,{prop:s.prop,label:s.label,width:s.width,key:X},null,8,["prop","label","width"]))),128))]),_:1},8,["data","highlight-current-row"]),V(P,{style:{"margin-top":"10px"},background:"","current-page":l.page,"onUpdate:currentPage":n[1]||(n[1]=s=>l.page=s),"page-size":l.limit,"onUpdate:pageSize":n[2]||(n[2]=s=>l.limit=s),layout:"prev, pager, next",total:l.total,onCurrentChange:G},null,8,["current-page","page-size","total"])])]),_:1},8,["multiple","onRemoveTag","modelValue"])}}});const L=I(re,[["__scopeId","data-v-a8a0c02b"]]),se=N({__name:"index",props:{modelValue:Array,bindValue:Array,displayLabel:{type:String,default:""}},setup(a){const d=a,o=y();T(()=>d.bindValue,r=>{const{displayLabel:m}=d,p=r?r.map(e=>e[m]):null;o.value=p},{immediate:!0});const g=["success","info","warning","danger"],w=()=>g[Math.floor(Math.random()*g.length)];return(r,m)=>{const p=b("el-tag");return f(),U("div",null,[(f(!0),U(z,null,B(o.value,(e,l)=>(f(),M(p,{class:"many-to-many-tag",type:w,key:l},{default:R(()=>[J(Y(e),1)]),_:2},1024))),128))])}}});const S=I(se,[["__scopeId","data-v-0838bf04"]]),{compute:u}=E(),ce=function({crudExpose:a,tabActivted:d}){const o=async e=>d.value==="receive"?await te(e):await Z(e),g=async({form:e,row:l})=>(e.id=l.id,await le(e)),w=async({row:e})=>await ne(e.id),r=async({form:e})=>await ae(e),m=async({row:e})=>await ee(e.id),p=D(()=>d.value==="receive");return{crudOptions:{request:{pageRequest:o,addRequest:r,editRequest:g,delRequest:w},actionbar:{buttons:{add:{show:D(()=>d.value!=="receive"&&q("messageCenter:Create"))}}},rowHandle:{fixed:"right",width:150,buttons:{edit:{show:!1},view:{text:"查看",type:"text",iconRight:"View",show:q("messageCenter:Search"),click({index:e,row:l}){a.openView({index:e,row:l}),d.value==="receive"&&(m({row:l}),a.doRefresh())}},remove:{iconRight:"Delete",type:"text",show:q("messageCenter:Delete")}}},columns:{id:{title:"id",form:{show:!1}},title:{title:"标题",search:{show:!0},type:["text","colspan"],column:{minWidth:120},form:{rules:[{required:!0,message:"必填项"}],component:{span:24,placeholder:"请输入标题"}}},is_read:{title:"是否已读",type:"dict-select",column:{show:p.value},dict:O({data:[{label:"已读",value:!0,color:"success"},{label:"未读",value:!1,color:"danger"}]}),form:{show:!1}},target_type:{title:"目标类型",type:["dict-radio","colspan"],column:{minWidth:120},dict:O({data:[{value:0,label:"按用户"},{value:1,label:"按角色"},{value:2,label:"按部门"},{value:3,label:"通知公告"}]}),form:{component:{optionName:"el-radio-button"},rules:[{required:!0,message:"必选项",trigger:["blur","change"]}]}},target_user:{title:"目标用户",search:{disabled:!0},form:{component:{name:h(L),vModel:"modelValue",displayLabel:u(({row:e})=>e?e.user_info:null),tableConfig:{url:"/api/system/user/",label:"name",value:"id",isMultiple:!0,columns:[{prop:"name",label:"用户名称",width:120},{prop:"phone",label:"用户电话",width:120}]}},show:u(({form:e})=>e.target_type===0),rules:[{required:!0,message:"必填项"}]},column:{show:!1,component:{name:h(S),vModel:"modelValue",bindValue:u(({row:e})=>e.user_info),displayLabel:"name"}}},target_role:{title:"目标角色",search:{disabled:!0},width:130,form:{component:{name:h(L),vModel:"modelValue",displayLabel:u(({row:e})=>e?e.role_info:null),tableConfig:{url:"/api/system/role/",label:"name",value:"id",isMultiple:!0,columns:[{prop:"name",label:"角色名称"},{prop:"key",label:"权限标识"}]}},show:u(({form:e})=>e.target_type===1),rules:[{required:!0,message:"必填项"}]},column:{show:!1,component:{name:h(S),vModel:"modelValue",bindValue:u(({row:e})=>e.role_info),displayLabel:"name"}}},target_dept:{title:"目标部门",search:{disabled:!0},width:130,type:"table-selector",form:{component:{name:h(L),vModel:"modelValue",displayLabel:u(({form:e})=>e.target_dept_name),tableConfig:{url:"/api/system/dept/all_dept/",label:"name",value:"id",isTree:!0,isMultiple:!0,columns:[{prop:"name",label:"部门名称",width:150},{prop:"status_label",label:"状态"},{prop:"parent_name",label:"父级部门"}]}},show:u(({form:e})=>e.target_type===2),rules:[{required:!0,message:"必填项"}]},column:{show:!1,component:{name:h(S),vModel:"modelValue",bindValue:u(({row:e})=>e.dept_info),displayLabel:"name"}}},content:{title:"内容",column:{width:300,show:!1},type:["editor-wang5","colspan"],form:{rules:[{required:!0,message:"必填项"}],component:{disabled:!0,id:"1",editorConfig:{readOnly:u(e=>{const{mode:l}=e;return l!=="add"})},uploader:{type:"form",buildUrl(e){return e.url}}}}}}}}};export{ce as createCrudOptions};
